<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Client â€¢ Track Parcel</title>
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<style>
body{font-family:Arial,sans-serif;background:#f0f4f8;padding:16px;}
.container{max-width:800px;margin:auto;background:white;padding:20px;border-radius:12px;box-shadow:0 5px 20px rgba(0,0,0,0.1);}
h2{text-align:center;color:#0f766e;margin-bottom:20px;}
.input-group{margin-bottom:12px;}
input{width:100%;padding:8px;border:1px solid #cbd5e1;border-radius:8px;}
button{padding:10px;background:#0f766e;color:white;border:none;border-radius:8px;cursor:pointer;margin-top:8px;}
button:hover{background:#0c5f59;}
.card{border:1px solid #cbd5e1;border-radius:8px;padding:16px;margin-top:12px;animation:fadeIn 0.5s;}
@keyframes fadeIn{from{opacity:0;transform:translateY(10px);}to{opacity:1;transform:translateY(0);}}
.status{font-weight:bold;margin:10px 0;}
.timeline{margin-top:16px;}
.step{padding:10px;border-left:4px solid #cbd5e1;margin-bottom:8px;position:relative;}
.step.active{border-left-color:#10b981;background:#dcfce7;}
.step::before{content:'';position:absolute;left:-7px;top:10px;width:12px;height:12px;border-radius:50%;background:#cbd5e1;}
.step.active::before{background:#10b981;}
#map{height:250px;border-radius:8px;margin-top:8px;}
.countdown{font-weight:bold;margin:8px 0;color:#0f766e;}
img.product-image{max-width:120px;margin-top:8px;border-radius:8px;}
</style>
</head>
<body>

<div class="container">
<h2>ðŸ“¦ Track Your Parcel</h2>

<div class="input-group">
<input id="trackingCode" placeholder="Enter Tracking Code">
</div>
<button onclick="trackParcel()">Track Parcel</button>

<div id="result"></div>
<div id="map"></div>
</div>

<script>
// Leaflet Map
let map = L.map('map').setView([37.0902, -95.7129], 4); // USA
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{
  maxZoom:19, attribution:'Â© OpenStreetMap'
}).addTo(map);
let marker;

// Track Parcel
function trackParcel(){
  const code = document.getElementById("trackingCode").value.trim();
  const result = document.getElementById("result");
  marker && map.removeLayer(marker);

  if(!code){
    result.innerHTML='<p style="color:red;">Enter a tracking code!</p>';
    return;
  }

  const parcels = JSON.parse(localStorage.getItem("enterprise_parcels")) || [];
  const parcel = parcels.find(p=>p.code===code);

  if(!parcel){
    result.innerHTML='<p style="color:red;">Tracking code not found!</p>';
    return;
  }

  // Map marker
  if(parcel.lat && parcel.lng){
    marker = L.marker([parcel.lat, parcel.lng]).addTo(map);
    map.setView([parcel.lat, parcel.lng],12);
  }

  // Countdown
  let deliveryDate = new Date(parcel.deliveryTime);
  clearInterval(window.countdownInterval);
  function updateCountdown(){
    const now = new Date();
    let diff = deliveryDate - now;
    if(diff<0){diff=0;}
    const days=Math.floor(diff/1000/60/60/24);
    const hours=Math.floor((diff/1000/60/60)%24);
    const minutes=Math.floor((diff/1000/60)%60);
    const seconds=Math.floor((diff/1000)%60);
    document.getElementById("countdown").innerText=`ETA: ${days}d ${hours}h ${minutes}m ${seconds}s`;
    if(diff<=0){clearInterval(window.countdownInterval);}
  }

  result.innerHTML=`
    <div class="card">
      <strong>Product:</strong> ${parcel.product}<br>
      <strong>Sender:</strong> ${parcel.sender}<br>
      <strong>Receiver:</strong> ${parcel.receiver}<br>
      <strong>Country:</strong> ${parcel.country}, <strong>City:</strong> ${parcel.city}<br>
      <strong>Address:</strong> ${parcel.address}<br>
      <strong>Charges:</strong> $${parcel.charges}<br>
      <strong>Delivery Date:</strong> ${deliveryDate.toLocaleString()}<br>
      <img class="product-image" src="${parcel.image?parcel.image:''}" alt="Product"><br>
      <div class="countdown" id="countdown"></div>

      <div class="timeline">
        <div class="step ${parcel.status!=='Pending'?'active':''}">Pending</div>
        <div class="step ${parcel.status==='In Transit'||parcel.status==='Delivered'?'active':''}">In Transit</div>
        <div class="step ${parcel.status==='Delivered'?'active':''}">Delivered</div>
      </div>
    </div>
  `;
  updateCountdown();
  window.countdownInterval = setInterval(updateCountdown,1000);
}
</script>
</body>
</html>
